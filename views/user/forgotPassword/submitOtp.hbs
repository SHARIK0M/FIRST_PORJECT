<main class="main">
    <!-- Breadcrumb Navigation -->
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow">Home</a>
                <span></span> OTP
            </div>
        </div>
    </div>

    <section class="pt-50 pb-150">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 m-auto">
                    <div class="row">
                        <div class="col-lg-5 m-auto">
                            <div class="login_wrap widget-taber-content p-30 background-white border-radius-10 mb-md-5 mb-lg-0 mb-sm-5">
                                <div class="padding_eight_all bg-white">
                                    <!-- OTP Form Header -->
                                    <div class="heading_s1">
                                        <h3 class="text-center mb-30">Enter OTP</h3>
                                    </div>

                                    <!-- OTP Form -->
                                    <form action="/otp" method="post">
                                        <!-- Error Message Display -->

                                        <!-- OTP Input Field -->
                                        <div class="form-floating mb-3 input-control">
                                            <input type="text" class="form-control" id="otp" placeholder="Enter OTP" name="otp" required>
                                            <label for="otp">Enter OTP</label>
                                        <h6 style="color: red;" class="text-center mb-3 mt-3">{{otpErr}}</h6>

                                        </div>

                                        <!-- Submit & Resend OTP Options -->
                                        <div class="text-center">
                                            <button type="submit" class="btn btn-fill-out btn-block hover-up">Submit</button>
                                            <p class="text-primary my-3">Time left: <span id="timer">60</span> seconds</p>
                                            <button class="btn hover-up" id="resendButton" onclick="resendOTP()">Resend OTP</button>
                                            <p id="resendMessage" class="text-success mt-2"></p>
                                        </div>
                                    </form> 
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Button Styling -->
    <style>
        #resendButton {
            color: #fff;
            background-color: hsl(185, 83%, 26%);
        }
    </style>

</main>

<!-- OTP Timer and Resend Functionality -->
<script>
    let countdown = 60; // Countdown timer in seconds
    let timerElement = document.getElementById('timer');
    let resendButton = document.getElementById('resendButton');
    let resendMessage = document.getElementById('resendMessage');
    let countdownInterval;

    // Function to update the countdown timer
    function updateTimer() {
        timerElement.textContent = countdown;
        countdown--;
        resendButton.disabled = true;

        if (countdown < 0) {
            clearInterval(countdownInterval);
            timerElement.textContent = '0 seconds';
            resendButton.disabled = false;
        }
    }

    // Function to resend OTP
    function resendOTP() {
        fetch('/resend_OTP', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                resendMessage.textContent = "OTP has been resent!";
                resendMessage.style.color = "green";

                // Restart the timer if OTP is successfully sent
                countdown = 60;
                timerElement.textContent = countdown;
                resendButton.disabled = true;
                clearInterval(countdownInterval);
                countdownInterval = setInterval(updateTimer, 1000);
            } else {
                resendMessage.textContent = data.error || "Error resending OTP.";
                resendMessage.style.color = "red";
            }
        })
        .catch(error => {
            console.error('Error:', error);
            resendMessage.textContent = "Network error, please try again.";
            resendMessage.style.color = "red";
        });
    }

    // Start the initial countdown timer
    countdownInterval = setInterval(updateTimer, 1000);
</script>